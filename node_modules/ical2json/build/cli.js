"use strict";
exports.__esModule = true;
var path = require("path");
var fs = require("fs");
var ical2json_1 = require("./ical2json");
var cwd = process.cwd();
/**
 * Pass in options to parse and generate JSON files
 * @param {Object} options
 * @return {Promise}
 */
function default_1(options) {
    var files = options.args || [];
    for (var i = 0; i < files.length; i++) {
        var file = files[i];
        var filePath = path.resolve(cwd, file);
        if (!fs.existsSync(filePath)) {
            continue;
        }
        var stat = fs.statSync(filePath);
        var ext = path.extname(filePath);
        var isConvert = !options.revert && ext === '.ics';
        var isRevert = options.revert && ext === '.json';
        if (!stat.isFile() || (!isConvert && !isRevert)) {
            continue;
        }
        var buffer = fs.readFileSync(filePath);
        var output = void 0;
        var data = buffer.toString();
        if (isConvert) {
            output = ical2json_1.convert(data);
            output = JSON.stringify(output, null, '  ');
        }
        else if (isRevert) {
            output = ical2json_1.revert(JSON.parse(data));
        }
        if (!output)
            continue;
        var basename = path.basename(filePath, ext);
        var dirname = path.dirname(filePath);
        var compiledExt = isConvert ? '.json' : '.ics';
        var writePath = path.join(dirname, basename) + compiledExt;
        fs.writeFileSync(writePath, output);
    }
    return true;
}
exports["default"] = default_1;
